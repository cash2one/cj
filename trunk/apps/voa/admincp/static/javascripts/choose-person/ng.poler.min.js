/**
 * @fileOverview poler 项目公共框架模块定义
 * @author 王利平
 * @version 0.1
 */
function existy(e){return null!=e}function truthy(e){return e!==!1&&existy(e)}function always(e){return function(){return e}}function cat(){var e=_.first(arguments);return existy(e)?e.concat.apply(e,_.rest(arguments)):[]}function construct(e,t){return cat(e,_.toArray(t))}function mapcat(e,t){return cat.apply(null,_.map(t,e))}function checker(){var e=_.toArray(arguments);return function(t){return _.reduce(e,function(e,n){return n(t)?e:_.chain(e).push(n.message).value()},[])}}function validator(e,t){var n=function(){return t.apply(t,arguments)};return n.message=e,n}function dispatch(){var e=_.toArray(arguments),t=e.length;return function(n){for(var r=void 0,o=_.rest(arguments),i=0;t>i;i++){var a=e[i];if(r=a.apply(a,[n].concat(o)),existy(r))return r}return r}}function condition(){var e=_.toArray(arguments);return function(t){var n=mapcat(function(e){return truthy(e(t))?[]:[e.message]},e);if(!_.isEmpty(n))throw new Error(n.join(" "));return!0}}function doWhen(e,t){return function(){var n=!1;try{n=e.apply(e,arguments)}catch(r){console.error(r)}return truthy(n)?t.apply(t,arguments):void 0}}angular.module("ng.poler.util",[]),angular.module("ng.poler",["ngRoute","ui.router","ng.poler.util"]),function(e){e.provider("Where",["$and",function(){var e={AND:"&&",OR:"||",EQ:"==",NEQ:"!=",LT:"<",LTE:"<=",GT:">",GTE:">=",IN:"in",NIN:"not in",NOT:"!",EXIST:"exist",NEXIST:"not exist",IS:"is"},t={format:function(e){return JSON.stringify(e)}},n=this.extend=function(n,r,o){e[n]=r,t[o]=function(e,t){var r=n;return[r,e,t]}};this.$get=function(){return t.extend=n,t}}])}(angular.module("ng.poler.util").constant("$and",function(e,t){return e||t?e?t?["AND",e,t]:e:t:null}).constant("$or",function(e,t){return e||t?e?t?["OR",e,t]:e:t:null}).constant("$eq",function(e,t){return["EQ",e,t]}).constant("$lt",function(e,t){return["LT",e,t]}).constant("$lte",function(e,t){return["LTE",e,t]}).constant("$gt",function(e,t){return["GT",e,t]}).constant("$gte",function(e,t){return["GTE",e,t]}).constant("$in",function(e,t){return["AND",e,t]}).constant("$not",function(e){return["NOT",e]}).constant("$exist",function(e,t){return["EXIST",e,t]})),function(e,t){"use strict";var n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");t.UUIDGenerator={},t.UUIDGenerator.uuid=function(e,t){var r,o=n,i=[];if(t=t||o.length,e)for(r=0;e>r;r++)i[r]=o[0|Math.random()*t];else{var a;for(i[8]=i[13]=i[18]=i[23]="-",i[14]="4",r=0;36>r;r++)i[r]||(a=0|16*Math.random(),i[r]=o[19==r?3&a|8:a])}return i.join("")},t.UUIDGenerator.uuidFast=function(){for(var e,t=n,r=new Array(36),o=0,i=0;36>i;i++)8==i||13==i||18==i||23==i?r[i]="-":14==i?r[i]="4":(2>=o&&(o=33554432+16777216*Math.random()|0),e=15&o,o>>=4,r[i]=t[19==i?3&e|8:e]);return r.join("")},t.UUIDGenerator.uuidCompact=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})},e.provider("UUIDGenerator",[function(){var e=this;e.$get=[function(){return t.UUIDGenerator}]}])}(angular.module("ng.poler.util"),window),function(e){"use strict";e.provider("Ios9Refresh",[function(){var e=this,t="empty-req.json";e.refreshUrl=function(e){t=e},e.$get=["$http",function(e){return{ajaxRefresh:function(){e.get(t).success(function(){}).error(function(){})}}}]}])}(angular.module("ng.poler.util"),window),function(e){"use strict";e.provider("Factories",["$controllerProvider","$compileProvider","$filterProvider","$routeProvider","$provide",function(e,t,n,r,o){var i=this;i.register={controller:e.register,directive:t.directive,filter:n.register,factory:o.factory,service:o.service},i.ServiceFactory={create:function(e,t){i.register.factory(e,t)}},i.ControllerFactory={create:function(e,t){i.register.controller(e,t)}},i.DirectiveFactory={create:function(e,t){i.register.directive(e,t)}},i.FilterFactory={create:function(e,t){i.register.filter(e,t)}},this.$get=function(){return function(){return{ServiceFactory:i.ServiceFactory,ControllerFactory:i.ControllerFactory,DirectiveFactory:i.DirectiveFactory,FilterFactory:i.FilterFactory}}}}])}(angular.module("ng.poler.util")),function(e){e.factory("$debounce",["$rootScope","$browser","$q","$exceptionHandler",function(e,t,n,r){function o(o,c,s){var l,f,p,d=n.defer(),g=d.promise,h=angular.isDefined(s)&&!s,v=!1;angular.forEach(a,function(e,t){angular.equals(a[t].fn,o)&&(v=!0,p=t)}),v?(i[a[p].timeoutId].reject("bounced"),t.defer.cancel(a[p].timeoutId)):(p=u++,a[p]={fn:o});var m=function(){delete a[p];try{d.resolve(o())}catch(t){d.reject(t),r(t)}h||e.$apply()};return l=t.defer(m,c),a[p].timeoutId=l,f=function(){delete i[g.$$timeoutId]},g.$$timeoutId=l,i[l]=d,g.then(f,f),g}var i={},a={},u=0;return o.cancel=function(e){return e&&e.$$timeoutId in i?(i[e.$$timeoutId].reject("canceled"),t.defer.cancel(e.$$timeoutId)):!1},o}])}(angular.module("ng.poler.util")),function(e,t){t.client_browser=function(){var e={ie:0,gecko:0,webkit:0,khtml:0,opera:0,ver:null},n={ie:0,firefox:0,safari:0,konq:0,opera:0,chrome:0,wx:0,ver:null},r={win:!1,mac:!1,x11:!1,iphone:!1,ipod:!1,ipad:!1,ios:!1,android:!1,nokiaN:!1,winMobile:!1,wii:!1,ps:!1},o=navigator.userAgent;if(t.opera)e.ver=n.ver=t.opera.version(),e.opera=n.opera=parseFloat(e.ver);else if(/AppleWebKit\/(\S+)/.test(o))if(e.ver=RegExp.$1,e.webkit=parseFloat(e.ver),/Chrome\/(\S+)/.test(o))n.ver=RegExp.$1,n.chrome=parseFloat(n.ver);else if(/Version\/(\S+)/.test(o))n.ver=RegExp.$1,n.safari=parseFloat(n.ver);else{var i=1;i=e.webkit<100?1:e.webkit<312?1.2:e.webkit<412?1.3:2,n.safari=n.ver=i}else/KHTML\/(\S+)/.test(o)||/Konqueror\/([^;]+])/.test(o)?(e.ver=n.ver=RegExp.$1,e.khtml=n.konq=parseFloat(e.ver)):/rv:([^\)]+)\) Gecko\/\d{8}/.test(o)?(e.ver=RegExp.$1,n.gecko=parseFloat(e.ver),/Firefox\/(\S+)/.test(o)&&(n.ver=RegExp.$1,n.firefox=parseFloat(n.ver))):/MSIE ([^;]+)/.test(o)&&(e.ver=n.ver=RegExp.$1,e.ie=n.ie=parseFloat(e.ver));/MicroMessenger\/([\d\.]+)/i.test(o)&&(n.ver=RegExp.$1,n.wx="micromessenger"),n.ie=e.ie,n.opera=e.opera;var a=navigator.platform;if(r.win=a.indexOf("Win")>=0,r.mac=a.indexOf("Mac")>=0,r.x11="X11"==a||0==a.indexOf("Linux"),r.win&&/Win(?:dows )?([^do]{2})\s?(\d+\.\d+)?/.test(o))if("NT"==RegExp.$1)switch(RegExp.$2){case"5.0":r.win="2000";break;case"5.1":r.win="XP";break;case"6.0":r.win="vista";break;case"6.1":r.win="7";break;default:r.win="NT"}else r.win="9x"==RegExp.$1?"ME":RegExp.$1;return r.iphone=o.indexOf("iPhone")>-1,r.ipod=o.indexOf("iPod")>-1,r.ipad=o.indexOf("iPad")>-1,r.nokiaN=o.indexOf("NokinaN")>-1,"CE"==r.win?r.winMobile=r.win:"Ph"==r.win&&/Window Phone OS (\d+.\d+)/.test(o)&&(r.win="Phone",r.winMobile=parseFloat(RegExp.$1)),r.iphone&&o.indexOf("Mobile")>-1&&(r.ios=/CPU (?:iPhone)?[ ]?OS (\d+_\d+)/.test(o)?parseFloat(RegExp.$1.replace("_",".")):2),/Android (\d+\.\d+)/.test(o)&&(r.android=parseFloat(RegExp.$1)),r.wii=o.indexOf("Wii")>-1,r.ps=/playstation/i.test(o),{engine:e,browser:n,system:r}}(),e.provider("Browser",[function(){var e=this;e.$get=[function(){return t.client_browser}]}])}(angular.module("ng.poler.util"),window),function(e){e.factory("TokenInterceptor",["$q","$window",function(){return{request:function(e){return e.headers=e.headers||{},e},response:function(e){return e}}}]).factory("TimestampMarker",["$q",function(e){var t=function(e){console.info(" 请求时间：["+(e.config.responseTimestamp-e.config.requestTimestamp)+"] "+e.config.url)};return{request:function(e){return e.requestTimestamp=(new Date).getTime(),e},response:function(e){return e.config.responseTimestamp=(new Date).getTime(),t(e),e},responseError:function(n){return n.config&&(n.config.responseTimestamp=(new Date).getTime(),t(n)),e.reject(n)}}}]).factory("HttpErrorInterceptor",["$injector","$q","InterceptorConfig",function(e,t,n){return{request:function(t){var r=void 0;if(angular.isString(n.requestHandler)){var o=e.get(n.requestHandler);r=o.handle(t)}return angular.isDefined(r)?r:t},requestError:function(r){var o=void 0;if(angular.isString(n.requestErrorHandler)){var i=e.get(n.requestErrorHandler);o=i.handle(response)}return angular.isDefined(o)?o:t.reject(r)},response:function(t){var r=void 0;if(angular.isString(n.responseHandler)){var o=e.get(n.responseHandler);r=o.handle(t)}return angular.isDefined(r)?r:t},responseError:function(r){var o=void 0;if(angular.isString(n.responseErrorHandler)){var i=e.get(n.responseErrorHandler);o=i.handle(r)}return angular.isDefined(o)?o:t.reject(r)}}}]).provider("InterceptorConfig",["$httpProvider",function(e){var t={requestHandler:function(){},requestErrorHandler:function(){},responseHandler:function(){},responseErrorHandler:function(){}};this.$get=[function(){return t}],this.configRequestHandler=function(e){return t.requestHandler=e,this},this.configRequestErrorHandler=function(e){return t.requestErrorHandler=e,this},this.configResponseHandler=function(e){return t.responseHandler=e,this},this.configResponseErrorHandler=function(e){return t.responseErrorHandler=e,this},this.push=function(t){if(angular.isString(t))e.interceptors.push(t);else if(angular.isArray(t)){var n;for(n=0;n<t.length;n++)e.interceptors.push(t[n])}}}])}(angular.module("ng.poler").config(["$httpProvider",function(e){e.interceptors.push("TimestampMarker"),e.interceptors.push("HttpErrorInterceptor"),e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8",e.defaults.headers.put["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8",e.defaults.headers.patch["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8",e.defaults.withCredentials=!0;var t=function(e){var n,r,o,i,a,u,c,s="";for(n in e)if(r=e[n],r instanceof Array)for(c=0;c<r.length;++c)a=r[c],o=n+"["+c+"]",u={},u[o]=a,s+=t(u)+"&";else if(r instanceof Object)for(i in r)a=r[i],o=n+"["+i+"]",u={},u[o]=a,s+=t(u)+"&";else void 0!==r&&null!==r&&(s+=encodeURIComponent(n)+"="+encodeURIComponent(r)+"&");return s.length?s.substr(0,s.length-1):s};e.defaults.transformRequest=[function(e){return angular.isObject(e)&&"[object File]"!==String(e)?t(e):e}]}])),function(e){e.provider("Page",[function(){var e=this;this.setTitle=function(e){setTimeout(function(){document.title=e;var t=$("body"),n=$('<iframe src="/favicon.ico" style="visibility: hidden;"></iframe>').on("load",function(){setTimeout(function(){n.off("load").remove()},0)}).appendTo(t)})},this.$get=["$timeout","$location","$anchorScroll","$state","$route","$document","$window",function(t,n,r,o,i,a,u){var c={};return c.setTitle=e.setTitle,c.goState=function(e,t,n){o.go(e,t,n)},c.goPage=function(e,t,r){return r||(r=""),n.path(e).search(t).hash(r)},c.goPos=function(e){return n.hash(e),e?(r(),n):void c.goTop()},c.goTop=function(){a.scrollTop(0)},c.refreshState=function(){o.go(o.current,{},{reload:!0})},c.refreshPage=function(e){u.location.reload(!!e)},c}]}]).directive("goTop",[function(){return{restrict:"A",compile:function(){return{pre:function(e,t,n){var r=t.find(n.goTopBtn),o=parseInt(n.goTop||300);0!=r.length&&(e.hide=function(){r.hide()},e.show=function(){r.show()},t.scroll(function(){$(this).scrollTop()>=o?e.show():e.hide()}),e.hide(),r.delegate(this,"click || touchstart",function(n){n.preventDefault(),n.stopPropagation(),t.scrollTop(0),e.hide()}),e.$on("$destroy",function(){r.remove()}))},post:function(){}}}}}]),e.factory("ListCacheFactory",["$location","$q","$timeout","Page","$document","$anchorScroll",function(e,t,n,r){function o(){var e=this;return t(function(t,n){e.loadFun.call(e).then(function(n){null==n.list&&(n.list=[]);for(var r=0;r<n.list.length;r++)e.dataList.push(n.list[r]);e.hasMore=n.total>e.dataList.length,t({hasMore:e.hasMore}),e.hasInit=!0},function(e){n(e)})})}var i={},a=Object.create(null);return a.refresh=function(){return this.hash="",this.listParams.page=1,this.dataList.length=0,o.call(this)},a.more=function(){return this.hasMore?(this.listParams.page+=1,o.call(this)):t(function(e){e({hasMore:!1})})},a.backHash=function(e){this.hash=e},a.enableRecall=function(e){this.hasRecall=e},a.init=function(e){var o=this;if(o.hasInit&&o.hasRecall)return t(function(e){n(function(){r.goPos(o.hash).replace(),e({hasMore:o.hasMore})})});e=e||{};for(var i in e)o.listParams[i]=e[i];return o.refresh()},a.clearInit=function(){this.hasInit=!1},function(e,t,n){var r=null;return i.hasOwnProperty(e)?r=i[e]:(r=i[e]=Object.create(a),r.listId=e,r.listParams={page:1},r.hash="",r.hasInit=!1,r.hasMore=!1,r.hasRecall=!0,r.dataList=[],r.loadFun=t),n&&n.hasOwnProperty("hasRecall")&&(r.hasRecall=n.hasRecall),r}}]).factory("ListPageFactory",["ListCacheFactory",function(e){return e}])}(angular.module("ng.poler")),function(e){var t={alert:function(e,t){alert(e[0]+"  = at =  "+t)},console:function(t,n){e.hasOwnProperty("old_console")||(e.old_console=e.console),e.old_console.log.apply(e.old_console,t),n&&e.old_console.log(n)},none:function(){}},n=t.console,r=4,o=function(){try{throw new Error}catch(e){var t=e.stack.replace(/Error.*\n/,"").split("\n");t.shift(),t.shift(),t=t.join("\n"),3>=r&&(t=void 0),n.apply(n,_.toArray(arguments).concat(t))}},i={config:function(e,o){return n="alert"==e?t.alert:"console"==e?t.console:t.none,"number"==typeof o&&(r=o),this},log:function(){return o(arguments),this},info:function(){return r>=1&&o(arguments),this},warn:function(){return r>=2&&o(arguments),this},debug:function(){return r>=3&&o(arguments),this},error:function(){return r>=4&&o(arguments),this},useOld:function(){return e.console=e.old_console,this}};e.console.useNew=function(t){e.old_console=e.console,e.console=t||i},e.console.config=function(){}}(window),function(e){"use strict";e.provider("localize",[function(){var e=this,t={};this.configLang=function(e,n){return angular.isString(e)&&(t[e]=n),this},this.$get=["$http","$rootScope","$q",function(n,r,o){var i={},a={configLang:e.configLang,setLang:function(e){var a=o.defer();if(angular.isUndefined(e)||!t.hasOwnProperty(e))return console.log("系统不支持语言：",e),!1;var u=t[e];return angular.isFunction(u)&&(u=u()),angular.isString(u)?n.get(u,{cache:!1}).success(function(t){i.data=t,i.name=e,r.$broadcast("localizeLanguageChanged"),a.resolve(t)}).error(function(e){console.log("Error updating language!",e),a.reject(e)}):!angular.isObject(u)||angular.isArray(u)||angular.isDate(u)?a.reject("语言配置信息错误",u):(i.data=u,i.name=e,r.$broadcast("localizeLanguageChanged"),a.resolve(u)),a.promise},localizeText:function(e){if(i.data){var t=i.data[e];if(t)return t}return e}};return a}]}]).directive("localize",["localize","$parse","$interpolate",function(e,t,n){var r=function(r,o,i){if(i.hasOwnProperty("localize")){var a;i.localize?a=t(i.localize)(r):(i.originalText||(i.originalText=n(o.is("input,textarea")?o.attr("placeholder"):o.text())),a=i.originalText(r));var u=e.localizeText(a);o.is("input, textarea")?o.attr("placeholder",u):o.text(u)}else{var a;i.data?a=t(i.data)(r):(i.originalText||(i.originalText=n(o.text())),a=i.originalText(r));var u=e.localizeText(a);o.text(u)}};return{restrict:"EA",link:function(e,t,n){r(e,t,n),e.$on("localizeLanguageChanged",function(){r(e,t,n)})}}}]).filter("localize",["localize",function(e){return function(t){return e.localizeText(t)}}])}(angular.module("ng.poler")),function(e,t){e.provider("RouterRole",["$locationProvider",function(e){var t=this,n={pathVar:"funcPath",commonViews_404:"app/components/404/views/404.html",componentsPath:"app/components",viewPath:"views",defaultFuncView:"index"};this.hashPrefix=function(t){t=t||"!",e.hashPrefix(t)},this.config=function(e){e.pathVar&&(n.pathVar=e.pathVar),e.commonViews_404&&(n.commonViews_404=e.commonViews_404),e.componentsPath&&(n.componentsPath=e.componentsPath),e.viewPath&&(n.viewPath=e.viewPath),e.defaultFuncView&&(n.defaultFuncView=e.defaultFuncView)},this.parseFuncViewUrlFactory=function(){return function(e){return t.parseFuncViewUrl(e[n.pathVar])}},this.parseFuncViewUrl=function(e){e=decodeURI(decodeURIComponent(e)),e=e.replace(/\./gi,"/"),e=e.replace(/\/$/,"");var t="";do{if(!e){t=n.commonViews_404;break}var r=e.split("?"),o="";2==r.length&&(o="?"+r[1]),e=r[0];var i=e.lastIndexOf("/")||e.length,a=e.substring(0,i),u=e.substring(i+1)||n.defaultFuncView;a||(a=u,u=n.defaultFuncView),t=n.componentsPath+"/"+a+"/"+n.viewPath+"/"+u+".html"}while(!1);return t},this.parseFuncDepsFactory=function(){return["$http","$stateParams","$q",function(e,t,n){var r=n.defer();return r.resolve(),r.promise}]},this.$get=[function(){return null}]}]).provider("Logger",[function(){this.config=function(){t.console.config(arguments)},this.$get=[function(){return t.console}]}]).provider("PolerConfig",[function(){var e=this;this.props={},this.config=function(t){angular.extend(e.props,t)},this.$get=[function(){return e.props}]}])}(angular.module("ng.poler"),window),function(e){e.controller("PolerCtrl",["$rootScope","$state","$location","$stateParams","$timeout","Page",function(e,t,n,r,o,i){e.$state=t,e.$stateParams=r,e.$location=n,e.setTitle=i.setTitle,e.goState=i.goState,e.goPage=i.goPage,e.goPos=i.goPos,e.$on("$stateChangeStart",function(){}),e.$on("$stateChangeSuccess",function(){}),e.$on("$stateChangeError",function(){}),e.$on("$viewContentLoading",function(){}),e.$on("$viewContentLoaded",function(){})}])}(angular.module("ng.poler")),function(e){e.factory("ApiUtil",["$http","$q",function(e,t){var n="",r={config:function(e){e.hasOwnProperty("URL_PREFIX")&&angular.isDefined(e.URL_PREFIX)&&(n=e.URL_PREFIX)},request:function(r,o,i,a,u){var c=t.defer(),s=u||{};return/http[s]?:\/\/.*/.test(r)||(r=n+r),i=i||{},e({method:o,url:r,params:i,data:a,timeout:s.timeout}).success(function(e){c.resolve(e)}).error(function(e){c.reject(e)}),c.promise},post:function(e,t,n){return r.request(e,"POST",null,t,n)},get:function(e,t,n){return r.request(e,"GET",t,null,n)},"delete":function(e,t,n){return r.request(e,"DELETE",null,t,n)},patch:function(e,t,n){return r.request(e,"PATCH",null,t,n)},put:function(e,t,n){return r.request(e,"PUT",null,t,n)}};return r}])}(angular.module("ng.poler"));