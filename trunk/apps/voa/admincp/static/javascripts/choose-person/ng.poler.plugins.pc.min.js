/**
 * Created by three on 15/11/30.
 */
angular.module("ng.poler.plugins.pc",["ng.poler","ui.bootstrap"]).config(["$httpProvider",function(e){e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8",e.defaults.headers.put["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8",e.defaults.headers.patch["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8",e.defaults.withCredentials=!0;var s=function(e){var t,a,n,i,c,r,l,d="";for(t in e)if(a=e[t],a instanceof Array)for(l=0;l<a.length;++l)c=a[l],n=t+"["+l+"]",r={},r[n]=c,d+=s(r)+"&";else if(a instanceof Object)for(i in a)c=a[i],n=t+"["+i+"]",r={},r[n]=c,d+=s(r)+"&";else void 0!==a&&null!==a&&(d+=encodeURIComponent(t)+"="+encodeURIComponent(a)+"&");return d.length?d.substr(0,d.length-1):d};e.defaults.transformRequest=[function(e){return angular.isObject(e)&&"[object File]"!==String(e)?s(e):e}]}]).run(["ApiUtil","app_config",function(e,s){e.config({URL_PREFIX:s.API.BASE_URL})}]),angular.module("ng.poler.plugins.pc").run(["$templateCache",function(e){e.put("templates/choose-advanced.html",'<div class="choose-person-plugin" ng-controller="AdvancedChooseCtrl"><div class="modal-head"><ul class="choose-menu"><li ng-if="params.person.isPerson" ng-click="tabChange(1)" ng-class="{\'active\':setShowWhat.person.isShow}">选人</li><li ng-if="params.tag.isTags" ng-click="tabChange(2)" ng-class="{\'active\':setShowWhat.tag.isShow}">标签</li><li ng-if="params.department.isDepartment" ng-click="tabChange(3)" ng-class="{\'active\':setShowWhat.department.isShow}">部门</li></ul></div><div><div id="person-view" ng-if="params.person.isPerson" ng-show="setShowWhat.person.isShow"><section class="modal-lr"><div class="modal-l"><div class="modal-search no-item"><div class="dem-item-wrap"><ul class="sel-dpm-item"><li class="sel-item">研发部</li><li class="sel-item">产品部</li><li class="sel-item">资源部</li><li class="sel-item">运营部</li></ul></div><div class="search-wrap"><span class="fadajing"></span> <input type="text" placeholder="搜索部门" onfocus="select()" data-ng-model="depQuery.keyword" data-ng-keypress="checkSearchDep($event)"> <a href="javascript:;" class="chosePer-icon chosePer-close input-close" data-ng-if="depQuery.keyword" data-ng-click="depQuery.keyword = null"></a></div></div><div class="tree department-tree"><div class="chosePer-warning-p"><i class="chosePer-icon chosePer-warning"></i> <span class="ver-bottom">当前部门不可选择</span></div><span class="clearSearch" data-ng-if="isSearchDep" data-ng-click="cancelSearchDep()">清除搜索 <i class="fa fa-times"></i></span><div><ul data-ng-repeat="dep in departmentListWithPerson"><li><div class="tree-item-content"><span class="cy-icon cy-arrow chosePer-icon" data-ng-class="{\'cy-open\':dep.isOpen, \'cy-kongbai\':dep.noChild}" data-ng-click="toggleDepWithPerson(dep.id)"></span><span class="cy-icon cy-folder"></span> <span class="dpm-name" data-ng-bind="dep.name" data-ng-click="clickDepartment(dep.id)"></span></div><ul collapse="!dep.isOpen" data-ng-repeat="dep1 in dep.childDep" data-ng-include="\'app/plugins/choose-person-page-node.html\'"></ul></li></ul></div></div></div><div class="modal-r"><div class="personnal-search" data-ng-class="{\'no-item\':selectedMembers.length==0}"><div class="ps-special-wrap"><div class="chosePer-warning-p"><i class="chosePer-icon chosePer-warning"></i> <span class="ver-bottom">当前人员不可选择</span></div></div><div class="per-item-Wrap"><ul class="sel-dpm-item"><li class="sel-item" data-ng-repeat="sm in selectedMembers"><span class="sel-personal-name ellipsis">{{sm.m_username}}</span> <a href="javascript:;" class="sel-item-del chosePer-icon chosePer-delete" data-ng-click="deleteMember($index)"></a></li></ul></div><div class="search-wrap"><span class="fadajing"></span> <input type="text" placeholder="搜索人员" onfocus="select()" data-ng-model="memberQuery.keyword" data-ng-keypress="checkSearchMember($event)"> <a href="javascript:;" class="chosePer-icon chosePer-close input-close" data-ng-if="memberQuery.keyword" data-ng-click="cancelSearchMember()"></a></div></div><div class="chosePer-options" data-ng-show="members.length > 0 && !singleSelect"><a href="javascript:void(0);" class="chosePer-fn" data-ng-click="selectAll()">全选</a> <a href="javascript:void(0);" class="chosePer-fn" data-ng-click="selectReverse()">反选</a> <a href="javascript:void(0);" class="chosePer-fn" data-ng-click="cancelAll()">清空</a></div><div class="personnal-avatar-wrap"><div class="per-list-wrap" data-ng-if="noMembers"><h3>没有员工</h3></div><div class="per-list-wrap" data-ng-if="!noMembers"><ul class="personnal-list"><li class="personnal-item" title="{{member.m_username}}" data-ng-class="{\'check\':member.selected, \'disable\':false}" data-ng-click="clickMembers($index)" data-ng-repeat="member in members"><div class="per-avatar"><img data-ng-src="{{member.m_face}}"><div class="isChecked" data-ng-if="member.selected"><i class="checked"></i></div></div><span class="per-name ellipsis" data-ng-bind="member.m_username"></span></li></ul><div class="load-more" data-ng-if="hasMore" data-ng-click="moreMembers()"><a href="javascript:void(0);">加载更多...</a></div></div></div></div></section></div><div id="department-view" ng-if="params.department.isDepartment" ng-show="setShowWhat.department.isShow"><div class="choose-body choose-body-department"><div class="modal-search no-item"><div class="dem-item-wrap"><ul class="sel-dpm-item"></ul></div><div class="search-wrap"><span class="fadajing"></span> <input type="text" placeholder="搜索部门" onfocus="select()" data-ng-model="depQuery.keyword" data-ng-keypress="checkSearchDep($event)"> <a href="javascript:;" class="chosePer-icon chosePer-close input-close" data-ng-if="depQuery.keyword" data-ng-click="depQuery.keyword = null"></a></div></div><div class="tree choose-department"><div class="chosePer-warning-p"><i class="chosePer-icon chosePer-warning"></i> <span class="ver-bottom">当前部门不可选择</span></div><span class="clearSearch" data-ng-if="isSearchDep" data-ng-click="cancelSearchDep()">清除搜索 <i class="fa fa-times"></i></span><div><ul data-ng-repeat="dep in departmentList" data-ng-if="dep.id != 0"><li><div class="tree-item-content"><span class="chosePer-icon cy-arrow" data-ng-class="{\'cy-open\':dep.isOpen, \'cy-kongbai\':dep.noChild}" data-ng-click="toggleDep(dep.id)"></span> <span class="chosePer-icon chosePer-checkBox" data-ng-click="selectDepartment(dep.id)" data-ng-class="{checked: dep.isChecked}"></span> <span class="chosePer-icon cy-folder" data-ng-click="selectDepartment(dep.id)"></span> <span class="dpm-name" data-ng-bind="dep.name" data-ng-click="selectDepartment(dep.id)"></span></div><ul collapse="!dep.isOpen" data-ng-repeat="dep1 in dep.childDep" data-ng-include="\'app/plugins/choose-dep-page-node.html\'"></ul></li></ul></div></div></div></div><div id="tags-view" class="tags-view" ng-if="params.tag.isTags" ng-show="setShowWhat.tag.isShow"><div class="tags-wrap"><label class="tags-tip">我的标签</label><ul class="tags-list"><li ng-repeat="tag in tags track by $index" ng-click="chooseTag($index)"><div class="tags-left"><div class="tags-name">{{tag.name}}</div></div><div class="tags-right"><span class="chosePer-icon chosePer-checkBox" ng-class="{\'checked\':tag.selected}"></span></div></li></ul><div class="load-more" ng-show="hasMoreTags" data-ng-click="moreTags()"><a href="javascript:void(0);">加载更多...</a></div></div></div></div><div class="modal-footer"><a href="javascript:void(0);" class="modal-btn btn-default btn-large" data-ng-click="doCancel()">取消</a> <a href="javascript:void(0);" class="modal-btn btn-confrim btn-large" data-ng-click="OK()">确定</a></div></div><script type="text/ng-template" id="app/plugins/choose-dep-page-node.html"><li data-ng-init="dep1_temp=dep1"> <div class="tree-item-content"> <span class="chosePer-icon cy-arrow" data-ng-class="{\'cy-open\':dep1.isOpen, \'cy-kongbai\':dep1.noChild}" data-ng-click="toggleDep(dep1.id)"></span> <span class="chosePer-icon chosePer-checkBox" data-ng-class="{checked: dep1.isChecked}" data-ng-click="selectDepartment(dep1.id)"></span> <span class="chosePer-icon cy-folder" data-ng-click="selectDepartment(dep1.id)"></span> <span class="dpm-name" data-ng-bind="dep1.name" data-ng-click="selectDepartment(dep1.id)"></span> </div> <ul data-ng-class="{\'collapse\':!$parent.dep1_temp.isOpen}" data-ng-repeat="dep1 in dep1.childDep" data-ng-include="\'app/plugins/choose-dep-page-node.html\'"><!-- 三级 --> <!-- 迭代树输出 --> </ul> </li></script><script type="text/ng-template" id="app/plugins/choose-person-page-node.html"><li data-ng-init="dep1_temp=dep1"> <div class="tree-item-content"> <span class="cy-icon cy-arrow chosePer-icon" data-ng-class="{\'cy-open\':dep1.isOpen, \'cy-kongbai\':dep1.noChild}" data-ng-click="toggleDep(dep1.id)"></span> <!--<span class="chosePer-icon chosePer-checkBox {{more_checked ? \'\': \'chosePer-cbdisable\'}}" data-ng-click=""></span>--> <span class="cy-icon cy-folder"></span> <span class="dpm-name" data-ng-bind="dep1.name" data-ng-click="clickDepartment(dep1.id)"></span> </div> <ul data-ng-class="{\'collapse\':!$parent.dep1_temp.isOpen}" data-ng-repeat="dep1 in dep1.childDep" data-ng-include="\'app/plugins/choose-person-page-node.html\'"><!-- 三级 --> <!-- 迭代树输出 --> </ul> </li></script>'),e.put("templates/choose-department.html",'<div class="choose-person-plugin" data-ng-controller="ChooseDepartCtrl"><div class="modal-head"><span class="mod-title">选择{{what1}}</span></div><div class="choose-body choose-body-department"><div class="modal-search no-item"><div class="dem-item-wrap"><ul class="sel-dpm-item"></ul></div><div class="search-wrap"><span class="fadajing"></span> <input type="text" placeholder="搜索{{what1}}" onfocus="select()" data-ng-model="depQuery.keyword" data-ng-keypress="checkSearchDep($event)"> <a href="javascript:;" class="chosePer-icon chosePer-close input-close" data-ng-if="depQuery.keyword" data-ng-click="depQuery.keyword = null"></a></div></div><div class="tree choose-department"><div class="chosePer-warning-p"><i class="chosePer-icon chosePer-warning"></i> <span class="ver-bottom">当前{{what1}}不可选择</span></div><span class="clearSearch" data-ng-if="isSearchDep" data-ng-click="cancelSearchDep()">清除搜索 <i class="fa fa-times"></i></span><div><ul data-ng-repeat="dep in departmentList" data-ng-if="dep.id != 0"><li><div class="tree-item-content"><span class="chosePer-icon cy-arrow" data-ng-class="{\'cy-open\':dep.isOpen, \'cy-kongbai\':dep.noChild}" data-ng-click="toggleDep(dep.id)"></span> <span class="chosePer-icon chosePer-checkBox" data-ng-click="selectDepartment(dep.id)" data-ng-class="{checked: dep.isChecked}"></span> <span class="chosePer-icon cy-folder" data-ng-click="selectDepartment(dep.id)"></span> <span class="dpm-name" data-ng-bind="dep.name" data-ng-click="selectDepartment(dep.id)"></span></div><ul collapse="!dep.isOpen" data-ng-repeat="dep1 in dep.childDep" data-ng-include="\'app/plugins/choose-dep-page-node.html\'"></ul></li></ul></div></div></div><div class="modal-footer"><a href="javascript:void(0);" class="modal-btn btn-default btn-large" data-ng-click="doCancel()">取消</a> <a href="javascript:void(0);" class="modal-btn btn-confrim btn-large" data-ng-click="OK()">确定</a></div></div><script type="text/ng-template" id="app/plugins/choose-dep-page-node.html"><li data-ng-init="dep1_temp=dep1"> <div class="tree-item-content"> <span class="chosePer-icon cy-arrow" data-ng-class="{\'cy-open\':dep1.isOpen, \'cy-kongbai\':dep1.noChild}" data-ng-click="toggleDep(dep1.id)"></span> <span class="chosePer-icon chosePer-checkBox" data-ng-class="{checked: dep1.isChecked}" data-ng-click="selectDepartment(dep1.id)"></span> <span class="chosePer-icon cy-folder" data-ng-click="selectDepartment(dep1.id)"></span> <span class="dpm-name" data-ng-bind="dep1.name" data-ng-click="selectDepartment(dep1.id)"></span> </div> <ul data-ng-class="{\'collapse\':!$parent.dep1_temp.isOpen}" data-ng-repeat="dep1 in dep1.childDep" data-ng-include="\'app/plugins/choose-dep-page-node.html\'"><!-- 三级 --> <!-- 迭代树输出 --> </ul> </li></script>'),e.put("templates/choose-person.html",'<div class="choose-person-plugin" data-ng-controller="ChoosePersonCtrl"><div class="modal-head"><span class="mod-title">选择{{what2}}</span></div><section class="modal-lr"><div class="modal-l"><div class="modal-search no-item"><div class="dem-item-wrap"><ul class="sel-dpm-item"><li class="sel-item">研发部</li><li class="sel-item">产品部</li><li class="sel-item">资源部</li><li class="sel-item">运营部</li></ul></div><div class="search-wrap"><span class="fadajing"></span> <input type="text" placeholder="搜索{{what1}}" onfocus="select()" data-ng-model="depQuery.keyword" data-ng-keypress="checkSearchDep($event)"> <a href="javascript:;" class="chosePer-icon chosePer-close input-close" data-ng-if="depQuery.keyword" data-ng-click="depQuery.keyword = null"></a></div></div><div class="tree department-tree"><div class="chosePer-warning-p"><i class="chosePer-icon chosePer-warning"></i> <span class="ver-bottom">当前{{what1}}不可选择</span></div><span class="clearSearch" data-ng-if="isSearchDep" data-ng-click="cancelSearchDep()">清除搜索 <i class="fa fa-times"></i></span><div><ul data-ng-repeat="dep in departmentList"><li><div class="tree-item-content"><span class="cy-icon cy-arrow chosePer-icon" data-ng-class="{\'cy-open\':dep.isOpen, \'cy-kongbai\':dep.noChild}" data-ng-click="toggleDep(dep.id)"></span><span class="cy-icon cy-folder"></span> <span class="dpm-name" data-ng-bind="dep.name" data-ng-click="clickDepartment(dep.id)"></span></div><ul collapse="!dep.isOpen" data-ng-repeat="dep1 in dep.childDep" data-ng-include="\'app/plugins/choose-person-page-node.html\'"></ul></li></ul></div></div></div><div class="modal-r"><div class="personnal-search" data-ng-class="{\'no-item\':selectedMembers.length==0}"><div class="ps-special-wrap"><div class="chosePer-warning-p"><i class="chosePer-icon chosePer-warning"></i> <span class="ver-bottom">当前{{what2}}不可选择</span></div></div><div class="per-item-Wrap"><ul class="sel-dpm-item"><li class="sel-item" data-ng-repeat="sm in selectedMembers"><span class="sel-personal-name ellipsis">{{sm.m_username}}</span> <a href="javascript:;" class="sel-item-del chosePer-icon chosePer-delete" data-ng-click="deleteMember($index)"></a></li></ul></div><div class="search-wrap"><span class="fadajing"></span> <input type="text" placeholder="搜索{{what2}}" onfocus="select()" data-ng-model="memberQuery.keyword" data-ng-keypress="checkSearchMember($event)"> <a href="javascript:;" class="chosePer-icon chosePer-close input-close" data-ng-if="memberQuery.keyword" data-ng-click="cancelSearchMember()"></a></div></div><div class="chosePer-options" data-ng-show="members.length > 0 && !singleSelect"><a href="javascript:void(0);" class="chosePer-fn" data-ng-click="selectAll()">全选</a> <a href="javascript:void(0);" class="chosePer-fn" data-ng-click="selectReverse()">反选</a> <a href="javascript:void(0);" class="chosePer-fn" data-ng-click="cancelAll()">清空</a></div><div class="personnal-avatar-wrap"><div class="per-list-wrap" data-ng-if="noMembers"><h3>没有{{what2}}</h3></div><div class="per-list-wrap" data-ng-if="!noMembers"><ul class="personnal-list"><li class="personnal-item" title="{{member.m_username}}" data-ng-class="{\'check\':member.selected, \'disable\':false}" data-ng-click="clickMembers($index)" data-ng-repeat="member in members"><div class="per-avatar"><img data-ng-src="{{member.m_face}}"><div class="isChecked" data-ng-if="member.selected"><i class="checked"></i></div></div><span class="per-name ellipsis" data-ng-bind="member.m_username"></span></li></ul><div class="load-more" data-ng-if="hasMore" data-ng-click="moreMembers()"><a href="javascript:void(0);">加载更多...</a></div></div></div><div class="per-btnGroup"><a href="javascript:void(0);" class="modal-btn btn-default btn-large" data-ng-click="doCancel()">取消</a> <a href="javascript:void(0);" class="modal-btn btn-confrim btn-large" data-ng-click="OK()">确定</a></div></div></section></div><script type="text/ng-template" id="app/plugins/choose-person-page-node.html"><li data-ng-init="dep1_temp=dep1"> <div class="tree-item-content"> <span class="cy-icon cy-arrow chosePer-icon" data-ng-class="{\'cy-open\':dep1.isOpen, \'cy-kongbai\':dep1.noChild}" data-ng-click="toggleDep(dep1.id)"></span> <!--<span class="chosePer-icon chosePer-checkBox {{more_checked ? \'\': \'chosePer-cbdisable\'}}" data-ng-click=""></span>--> <span class="cy-icon cy-folder"></span> <span class="dpm-name" data-ng-bind="dep1.name" data-ng-click="clickDepartment(dep1.id)"></span> </div> <ul data-ng-class="{\'collapse\':!$parent.dep1_temp.isOpen}" data-ng-repeat="dep1 in dep1.childDep" data-ng-include="\'app/plugins/choose-person-page-node.html\'"><!-- 三级 --> <!-- 迭代树输出 --> </ul> </li></script>')}]),angular.module("ng.poler.plugins.pc").constant("app_config",{API:{BASE_URL:"/",REQUEST_TIMEOUT:1e4,CHECK_LOGIN_DELAY:2e3,CHECK_CHAT_GROUP:1e3,MSG_NOTICE:6e4,CHECK_SUCCESS:function(e){try{return e.errcode==this.RES_CODE.SUCCESS}catch(s){return!1}},RES_CODE:{SUCCESS:"0",UNAUTHENTICATED:"10004",UNAUTHENTICATED2:"5025"}}}),function(app,window){app.controller("ChooseShimCtrl",["$scope","PersonChooser","DepartmentChooser",function($scope,PersonChooser,DepartmentChooser){function calShimParams(paramName){var shimParams=eval(paramName),selected=[],config={singleSelect:!1};if(shimParams instanceof Array)selected=shimParams;else{for(var k in config)config[k]=shimParams.hasOwnProperty(k)?shimParams[k]:config[k];selected=shimParams.hasOwnProperty("selected")?shimParams.selected:[]}return{selected:selected,config:config}}$scope.selectPerson=function(selectedPerson,callback,customParams){var shimParams=calShimParams(selectedPerson);PersonChooser.choose(shimParams.selected,null,shimParams.config).result.then(function(data){var fun=eval(callback);fun(data,customParams)})},$scope.selectDepartment=function(selectedDepartment,callback,customParams){var shimParams=calShimParams(selectedDepartment);DepartmentChooser.choose(shimParams.selected,null,shimParams.config).result.then(function(data){var fun=eval(callback);fun(data,customParams)})}}]);var ShimApp=function(){var e=null;return function(){return e||(e=angular.bootstrap(angular.element("<div></div>"),["ng.poler.plugins.pc"])),e}}();window.shimChoosePerson=function(e,s,t){ShimApp().invoke(["$q","PersonChooser",function(a,n){n.choose(e,null,s).result.then(function(e){t(e)})}])},window.shimChooseDepartment=function(e,s,t){ShimApp().invoke(["$q","DepartmentChooser",function(a,n){n.choose(e,null,s).result.then(function(e){t(e)})}])},window.advancedChoose=function(e,s,t){ShimApp().invoke(["AdvancedChooser",function(a){a.choose(e,null,s).result.then(function(e){t(e)})}])},window.ChooseApiConfig=function(e){ShimApp().invoke(["ApiUtil",function(s){s.config({URL_PREFIX:e.hostPath})}])}}(angular.module("ng.poler.plugins.pc"),window),function(e){e.factory("ChoosePublicMethod",[function(){return{_bindChooseWhat:function(e){for(var s={},t=[{what1:"部门"},{what2:"人员"}],a=0;a<t.length;a++)for(var n in t[a])s[n]=t[a][n];if(!e)return s;for(var a=0;a<e.length;a++)for(var n in e[a])s[n]=e[a][n];return s}}}]),e.factory("ChoosePersonService",["$http","$q","ApiUtil","ChoosePublicMethod",function(e,s,t,a){return{department:function(e){return t.get("PubApi/Apicp/Addressbook/ListDepartment",e)},member:function(e){return t.get("PubApi/Apicp/Addressbook/ListMember",e)},tag:function(e){return t.get("PubApi/Apicp/Clabel/List",e)},bindChooseWhat:function(e){return a._bindChooseWhat.call(null,e)}}}])}(angular.module("ng.poler.plugins.pc")),function(e){e.controller("ChoosePersonCtrl",["$scope","ApiUtil","ChoosePersonService","app_config",function(e,s,t,a){function n(s){for(var t=e.selectedMembers.length,a=0;t>a;a++){var n=e.selectedMembers[a];if(n.m_uid==s.m_uid)return!0}return!1}e.allDep={},e.noMembers=!1;var i=[],c=t.bindChooseWhat(e.chooseWhat);for(var r in c)e[r]=c[r];var l=function(){if(e.departmentList=t.department({}).then(function(s){if(a.API.CHECK_SUCCESS(s)){i=e.departmentList=s.result.departments;for(var t in s.result.departments){var n=s.result.departments[t];n.noChild=!1,0==n.id&&(n.noChild=!0),e.allDep[n.id]=n}e.departmentList.length>0&&(e.memberQuery.cd_id=e.departmentList[0].id),d()}},function(e){console.log("选人组件.请求部分信息错误",e)}),angular.isArray(e.selectedList)){e.selectedMembers=e.selectedList;for(var s in e.selectedMembers)e.selectedMembers[s].selected=!0}};e.depQuery={},e.isSearchDep=!1,e.toggleDep=function(s){var n=e.allDep[s];n.isOpen=!n.isOpen,n.childDep&&n.childDep.length>0||n.noChild||(e.depQuery.cd_id=s,t.department(e.depQuery).then(function(s){if(a.API.CHECK_SUCCESS(s)){var t=s.result.departments;if(t.length>0){for(var i in t){var c=t[i];c.noChild=!1,e.allDep[c.id]=c}n.childDep=t}else n.noChild=!0}},function(e){console.log("选人组件.请求部分信息错误",e)}))},e.checkSearchDep=function(s){e.depQuery.keyword&&13==s.keyCode&&t.department(e.depQuery).then(function(s){if(a.API.CHECK_SUCCESS(s)){e.departmentList=s.result.departments;for(var t in e.departmentList)e.departmentList[t].noChild=!0}e.isSearchDep=!0},function(e){console.log("选人组件.请求部分信息错误",e)})},e.cancelSearchDep=function(){e.departmentList=i,e.depQuery.keyword=null,e.isSearchDep=!1},e.memberQuery={page:1,limit:35};var d=function(){e.members=t.member(e.memberQuery).then(function(s){e.members=s.result.members,e.hasMore=e.members.length<s.result.total;for(var t in s.result.members)for(var a in e.selectedMembers)if(e.selectedMembers[a].m_uid==s.result.members[t].m_uid){s.result.members[t].selected=!0;break}e.noMembers=0==e.members.length?!0:!1},function(e){console.log("选人组件.请求人员信息错误",e)})};e.moreMembers=function(){e.memberQuery.page+=1,t.member(e.memberQuery).then(function(s){for(var t in s.result.members){e.members.push(s.result.members[t]);for(var a in e.selectedMembers)if(e.selectedMembers[a].m_uid==s.result.members[t].m_uid){s.result.members[t].selected=!0;break}}e.hasMore=e.members.length<s.result.total},function(e){console.log("选人组件.请求人员信息错误",e)})},e.clickDepartment=function(s){e.memberQuery.page=1,e.memberQuery.cd_id=s,d()},e.checkSearchMember=function(s){13==s.keyCode&&(e.memberQuery.page=1,d())},e.cancelSearchMember=function(){e.memberQuery.page=1,e.memberQuery.keyword=null,d()},e.selectedMembers=[],e.fatherDom=$(".per-item-Wrap"),e.delDomItem=$(".per-item-Wrap .sel-dpm-item"),e.cumulationWidth=0,e.initWidth=65,e.setContentWidth=function(s){var t=s;e.delDomItem.css({width:t+10}),t>=465&&e.fatherDom.css({width:465}),465>t&&e.fatherDom.css({width:t+10})},e.selectedList&&(e.cumulationWidth=e.selectedList.length*e.initWidth,e.setContentWidth(e.cumulationWidth)),e.clickMembers=function(s){var t=e.members[s];if(t.selected=!t.selected,t.selected)e.singleSelect&&(e.selectedMembers.forEach(function(e){e.selected=!1}),e.selectedMembers.length=0),e.selectedMembers.push(t);else for(var a in e.selectedMembers)if(t.m_uid==e.selectedMembers[a].m_uid){e.selectedMembers.splice(a,1);break}e.cumulationWidth=e.initWidth*e.selectedMembers.length,e.setContentWidth(e.cumulationWidth)},e.deleteMember=function(s){if(e.selectedMembers[s].selected=!1,e.cumulationWidth-=e.initWidth,e.setContentWidth(e.cumulationWidth),e.members)for(var t in e.members)if(e.members[t].m_uid==e.selectedMembers[s].m_uid){e.members[t].selected=!1;break}e.selectedMembers.splice(s,1)},e.selectAll=function(){for(var s in e.members)e.members[s].selected=!0,n(e.members[s])||e.selectedMembers.push(e.members[s]);e.cumulationWidth=e.selectedMembers.length*e.initWidth,e.setContentWidth(e.cumulationWidth)},e.cancelAll=function(){e.selectedMembers=[],e.cumulationWidth=0,e.setContentWidth(e.cumulationWidth);for(var s in e.members)e.members[s].selected=!1},e.selectReverse=function(){e.selectedMembers=[];for(var s in e.members)e.members[s].selected=!e.members[s].selected,e.members[s].selected&&e.selectedMembers.push(e.members[s]);e.cumulationWidth=e.selectedMembers.length?e.selectedMembers.length*e.initWidth:0,e.setContentWidth(e.cumulationWidth)},e.OK=function(){e.doOk(e.selectedMembers)},l()}]),e.factory("PersonChooser",["$q","$modal",function(e,s){return{choose:function(t,a,n){var i=e.defer(),c=s.open({templateUrl:"templates/choose-person.html",size:a||"lg",resolve:{selected:function(){return t?JSON.parse(JSON.stringify(t)):null},params:function(){return n||{}}},controller:["$scope","$modalInstance","selected","params",function(e,s,t,a){for(var n in a)e[n]=a[n];e.selectedList=t,e.doOk=function(e){s.close(e)},e.doCancel=function(e){s.dismiss(e||"cancel")}}]});return c.opened.then(function(){}),c.result.then(function(e){i.resolve(e)},function(e){i.reject(e)}),{result:i.promise}}}}])}(angular.module("ng.poler.plugins.pc")),function(e){e.controller("ChooseDepartCtrl",["$scope","ApiUtil","ChoosePersonService","app_config",function(e,s,t,a){function n(s){for(var t=0;t<e.selectedList.length;t++)if(e.selectedList[t].id==s)return!0;return!1}function i(s){for(var t=0;t<e.selectedList.length&&e.selectedList[t].id!=s;t++);t<e.selectedList.length&&e.selectedList.splice(t,1)}function c(e,s){if(e.isChecked=s,e.number=0,e.childDep)for(var t in e.childDep)c(e.childDep[t],s)}function r(e){var s=[];for(var t in e){var a=e[t];a.isChecked&&s.push(a)}return s}var l=null;e.allDep={},e.depQuery={};var d=t.bindChooseWhat(e.chooseWhat);for(var o in d)e[o]=d[o];var p=function(){e.departmentList=t.department({}).then(function(s){if(a.API.CHECK_SUCCESS(s)){l=e.departmentList=s.result.departments;for(var t in s.result.departments){var i=s.result.departments[t];i.isChecked=n(i.id),0==i.id&&(i.noChild=!0),e.allDep[i.id]=i}}},function(e){console.log("选人组件.请求部门信息错误",e)})};e.depQuery={},e.isSearchDep=!1,e.toggleDep=function(s){e.allDep[s].isOpen=!e.allDep[s].isOpen,e.allDep[s].childDep&&e.allDep[s].childDep.length>0||e.allDep[s].noChild||(e.depQuery.cd_id=s,e.allDep[s].number=0,t.department(e.depQuery).then(function(t){if(a.API.CHECK_SUCCESS(t))if(t.result.departments.length>0){for(var i in t.result.departments){var c=t.result.departments[i],r=e.allDep.hasOwnProperty(c.id);c.parentDep_id=s,c.parent_id=s,c.isChecked=n(c.id)||e.allDep[s].isChecked||r&&e.allDep[c.id].isChecked,e.allDep[c.id]=c}if(e.allDep[s].childDep=t.result.departments,e.allDep[s].isChecked){var l=e.allDep[s].childDep.length;e.allDep[s].number=l}}else e.allDep[s].noChild=!0},function(e){console.log("选人组件.请求部分信息错误",e)}))},e.selectDepartment=function(s){var t=e.allDep[s];if(t.isChecked=!t.isChecked,t.hasOwnProperty("number")||(t.number=0),t.isChecked||i(t.id),e.isSearchDep)for(var a=0;a<e.departmentList.length;a++)e.departmentList[a].id==s?e.departmentList[a].isChecked=!e.departmentList[a].isChecked:e.singleSelect&&(e.departmentList[a].isChecked=!1);if(e.singleSelect&&t.isChecked)for(var n in e.allDep)n!=s&&(e.allDep[n].isChecked=!1);if(t.childDep&&!e.isSearchDep)for(var a in t.childDep)c(t.childDep[a],t.isChecked)},e.OK=function(){e.doOk(r(e.allDep))},e.checkSearchDep=function(s){e.depQuery.keyword&&(e.depQuery.cd_id=null,13==s.keyCode&&t.department(e.depQuery).then(function(s){if(a.API.CHECK_SUCCESS(s)){e.departmentList=s.result.departments;for(var t in e.departmentList){var i=e.departmentList[t],c=e.allDep.hasOwnProperty(i.id);i.noChild=!0,i.isChecked=n(i.id)||c&&e.allDep[i.id].isChecked,c||(e.allDep[i.id]=JSON.parse(JSON.stringify(i)))}}e.isSearchDep=!0},function(e){console.log("选人组件.请求部分信息错误",e)}))},e.cancelSearchDep=function(){e.departmentList=l,e.depQuery.keyword=null,e.isSearchDep=!1},p()}]),e.factory("DepartmentChooser",["$q","$modal",function(e,s){return{choose:function(t,a,n){var i=e.defer(),c=s.open({templateUrl:"templates/choose-department.html",size:a||"lg",resolve:{selected:function(){return t?JSON.parse(JSON.stringify(t)):null},params:function(){return n||{}}},controller:["$scope","$modalInstance","selected","params",function(e,s,t,a){for(var n in a)e[n]=a[n];e.selectedList=t,e.doOk=function(e){s.close(e)},e.doCancel=function(e){s.dismiss(e||"cancel")}}]});return c.opened.then(function(){}),c.result.then(function(e){i.resolve(e)},function(e){i.reject(e)}),{result:i.promise}}}}])}(angular.module("ng.poler.plugins.pc")),function(e){e.controller("AdvancedChooseCtrl",["$scope","$timeout","ChoosePersonService","app_config","TagsService",function(e,s,t,a,n){var i=e.params;!function(){var s={person:{isShow:i.person&&i.person.isShow||!1,isSingle:i.person&&i.person.isSingle||!1,isPerson:i.person&&i.person.isPerson||!1},department:{isShow:i.department&&i.department.isShow||!1,isSingle:i.department&&i.department.isSingle||!1,isDepartment:i.department&&i.department.isDepartment||!1},tag:{isShow:i.tag&&i.tag.isShow||!1,isSingle:i.tag&&i.tag.isSingle||!1,isTags:i.tag&&i.tag.isTags||!1}};e.params=s}(),e.setShowWhat={person:{isShow:e.params.person.isShow},department:{isShow:e.params.department.isShow},tag:{isShow:e.params.tag.isShow}},e.tabChange=function(s){1==s?(e.setShowWhat.person.isShow=!0,e.setShowWhat.department.isShow=!1,e.setShowWhat.tag.isShow=!1):2==s?(e.setShowWhat.department.isShow=!1,e.setShowWhat.person.isShow=!1,e.setShowWhat.tag.isShow=!0):3==s&&(e.setShowWhat.person.isShow=!1,e.setShowWhat.department.isShow=!0,e.setShowWhat.tag.isShow=!1)};var c=function(){e.allDepWithPerson={},e.noMembers=!1,e.depQuery={},e.isSearchDep=!1,e.selectedMembers=[],e.memberQuery={page:1,limit:35};var n=[],i=function(){if(e.departmentListWithPerson=t.department({}).then(function(s){if(a.API.CHECK_SUCCESS(s)){n=e.departmentListWithPerson=s.result.departments;for(var t in s.result.departments){var i=s.result.departments[t];i.noChild=!1,0==i.id&&(i.noChild=!0),e.allDepWithPerson[i.id]=i}e.departmentListWithPerson.length>0&&(e.memberQuery.cd_id=e.departmentListWithPerson[0].id),c()}},function(e){console.log("选人组件.请求部分信息错误",e)}),angular.isArray(e.selectedList.selectedPersons)){e.selectedMembers=e.selectedList.selectedPersons;for(var s in e.selectedMembers)e.selectedMembers[s].selected=!0}};e.toggleDepWithPerson=function(s){var n=e.allDepWithPerson[s];n.isOpen=!n.isOpen,n.childDep&&n.childDep.length>0||n.noChild||(e.depQuery.cd_id=s,t.department(e.depQuery).then(function(s){if(a.API.CHECK_SUCCESS(s)){var t=s.result.departments;if(t.length>0){for(var i in t){var c=t[i];c.noChild=!1,e.allDepWithPerson[c.id]=c}n.childDep=t}else n.noChild=!0}},function(e){console.log("选人组件.请求部分信息错误",e)}))},e.checkSearchDep=function(s){e.depQuery.keyword&&13==s.keyCode&&t.department(e.depQuery).then(function(s){if(a.API.CHECK_SUCCESS(s)){e.departmentListWithPerson=s.result.departments;for(var t in e.departmentListWithPerson)e.departmentListWithPerson[t].noChild=!0}e.isSearchDep=!0},function(e){console.log("选人组件.请求部分信息错误",e)})},e.cancelSearchDep=function(){e.departmentListWithPerson=n,e.depQuery.keyword=null,e.isSearchDep=!1};var c=function(){e.members=t.member(e.memberQuery).then(function(s){e.members=s.result.members,e.hasMore=e.members.length<s.result.total;for(var t in s.result.members)for(var a in e.selectedMembers)if(e.selectedMembers[a].m_uid==s.result.members[t].m_uid){s.result.members[t].selected=!0;break}e.noMembers=0==e.members.length?!0:!1},function(e){console.log("选人组件.请求人员信息错误",e)})};e.moreMembers=function(){e.memberQuery.page+=1,t.member(e.memberQuery).then(function(s){e.members.total=s.result.total;for(var t in s.result.members){e.members.push(s.result.members[t]);for(var a in e.selectedMembers)if(e.selectedMembers[a].m_uid==s.result.members[t].m_uid){s.result.members[t].selected=!0;break}}e.hasMore=e.members.length<s.result.total},function(e){console.log("选人组件.请求人员信息错误",e)})},e.clickDepartment=function(s){e.memberQuery.page=1,e.memberQuery.cd_id=s,c()},e.checkSearchMember=function(s){13==s.keyCode&&(e.memberQuery.page=1,c())},e.cancelSearchMember=function(){e.memberQuery.page=1,e.memberQuery.keyword=null,c()},s(function(){function s(s){for(var t=e.selectedMembers.length,a=0;t>a;a++){var n=e.selectedMembers[a];if(n.m_uid==s.m_uid)return!0}return!1}e.fatherDom=$(".per-item-Wrap"),e.delDomItem=$(".per-item-Wrap .sel-dpm-item"),e.cumulationWidth=0,e.initWidth=65,e.setContentWidth=function(s){var t=s;e.delDomItem.css({width:t+10}),t>=465&&e.fatherDom.css({width:465}),465>t&&e.fatherDom.css({width:t+10})},e.selectedList.selectedPersons&&(e.cumulationWidth=e.selectedList.selectedPersons.length*e.initWidth,e.setContentWidth(e.cumulationWidth)),e.clickMembers=function(s){var t=e.members[s];
if(t.selected=!t.selected,t.selected)e.setShowWhat.person.isSingle&&(e.selectedMembers.forEach(function(e){e.selected=!1}),e.selectedMembers.length=0),e.selectedMembers.push(t);else for(var a in e.selectedMembers)if(t.m_uid==e.selectedMembers[a].m_uid){e.selectedMembers.splice(a,1);break}e.cumulationWidth=e.initWidth*e.selectedMembers.length,e.setContentWidth(e.cumulationWidth)},e.deleteMember=function(s){if(e.selectedMembers[s].selected=!1,e.cumulationWidth-=e.initWidth,e.setContentWidth(e.cumulationWidth),e.members)for(var t in e.members)if(e.members[t].m_uid==e.selectedMembers[s].m_uid){e.members[t].selected=!1;break}e.selectedMembers.splice(s,1)},e.selectAll=function(){for(var t in e.members)e.members[t].selected=!0,s(e.members[t])||e.selectedMembers.push(e.members[t]);e.cumulationWidth=e.selectedMembers.length*e.initWidth,e.setContentWidth(e.cumulationWidth)},e.cancelAll=function(){e.selectedMembers=[],e.cumulationWidth=0,e.setContentWidth(e.cumulationWidth);for(var s in e.members)e.members[s].selected=!1},e.selectReverse=function(){e.selectedMembers=[];for(var s in e.members)e.members[s].selected=!e.members[s].selected,e.members[s].selected&&e.selectedMembers.push(e.members[s]);e.cumulationWidth=e.selectedMembers.length?e.selectedMembers.length*e.initWidth:0,e.setContentWidth(e.cumulationWidth)}}),i()},r=function(){function s(s){for(var t=0;t<e.selectedList.selectedDepartment.length;t++)if(e.selectedList.selectedDepartment[t].id==s)return!0;return!1}function n(s){for(var t=0;t<e.selectedList.selectedDepartment.length&&e.selectedList.selectedDepartment[t].id!=s;t++);t<e.selectedList.selectedDepartment.length&&e.selectedList.selectedDepartment.splice(t,1)}function i(e,s){if(e.isChecked=s,e.number=0,e.childDep)for(var t in e.childDep)i(e.childDep[t],s)}var c=null;e.allDep={},e.depQuery={};var r=function(){e.departmentList=t.department({}).then(function(t){if(a.API.CHECK_SUCCESS(t)){c=e.departmentList=t.result.departments;for(var n in t.result.departments){var i=t.result.departments[n];i.isChecked=s(i.id),0==i.id&&(i.noChild=!0),e.allDep[i.id]=i}}},function(e){console.log("选人组件.请求部门信息错误",e)})};e.depQuery={},e.isSearchDep=!1,e.toggleDep=function(n){e.allDep[n].isOpen=!e.allDep[n].isOpen,e.allDep[n].childDep&&e.allDep[n].childDep.length>0||e.allDep[n].noChild||(e.depQuery.cd_id=n,e.allDep[n].number=0,t.department(e.depQuery).then(function(t){if(a.API.CHECK_SUCCESS(t))if(t.result.departments.length>0){for(var i in t.result.departments){var c=t.result.departments[i],r=e.allDep.hasOwnProperty(c.id);c.parentDep_id=n,c.parent_id=n,c.isChecked=s(c.id)||e.allDep[n].isChecked||r&&e.allDep[c.id].isChecked,e.allDep[c.id]=c}if(e.allDep[n].childDep=t.result.departments,e.allDep[n].isChecked){var l=e.allDep[n].childDep.length;e.allDep[n].number=l}}else e.allDep[n].noChild=!0},function(e){console.log("选人组件.请求部分信息错误",e)}))},e.selectDepartment=function(s){var t=e.allDep[s];if(t.isChecked=!t.isChecked,t.hasOwnProperty("number")||(t.number=0),t.isChecked||n(t.id),e.isSearchDep)for(var a=0;a<e.departmentList.length;a++)e.departmentList[a].id==s?e.departmentList[a].isChecked=!e.departmentList[a].isChecked:e.setShowWhat.department.isSingle&&(e.departmentList[a].isChecked=!1);if(e.setShowWhat.department.isSingle&&t.isChecked)for(var c in e.allDep)c!=s&&(e.allDep[c].isChecked=!1);if(t.childDep&&!e.isSearchDep)for(var a in t.childDep)i(t.childDep[a],t.isChecked)},e.computeSelectedDepartment=function(e){var s=[];for(var t in e){var a=e[t];a.isChecked&&s.push(a)}return s},e.checkSearchDep=function(n){e.depQuery.keyword&&(e.depQuery.cd_id=null,13==n.keyCode&&t.department(e.depQuery).then(function(t){if(a.API.CHECK_SUCCESS(t)){e.departmentList=t.result.departments;for(var n in e.departmentList){var i=e.departmentList[n],c=e.allDep.hasOwnProperty(i.id);i.noChild=!0,i.isChecked=s(i.id)||c&&e.allDep[i.id].isChecked,c||(e.allDep[i.id]=JSON.parse(JSON.stringify(i)))}}e.isSearchDep=!0},function(e){console.log("选人组件.请求部分信息错误",e)}))},e.cancelSearchDep=function(){e.departmentList=c,e.depQuery.keyword=null,e.isSearchDep=!1},r()},l=function(){var s={page:1,limit:10},a=0;e.tags=t.tag(s).then(function(s){if(0==s.errcode){e.tags=n._tags=s.result.list,e.hasMoreTags=n.hasMore(s.result.count);for(var t in s.result.list)for(var a in n.checks)if(n.checks[a].ccl_id==s.result.list[t].ccl_id){s.result.list[t].selected=!0;break}}},function(){}),e.moreTags=function(){s.page+=1,t.tag(s).then(function(s){a=s.result.total;for(var t in s.result.list)n._tags.push(s.result.list[t]),e.tags.push(s.result.list[t]);e.hasMoreTags=n.hasMore(s.result.count)})},n.init({isSingle:e.params.tag.isSingle}),e.chooseTag=n.clickTag};e.OK=function(){e.selectedList.selectedPersons=e.selectedMembers,e.selectedList.selectedDepartment=e.computeSelectedDepartment(e.allDep),e.selectedList.selectedTags=n.checks,e.doOk(e.selectedList)},function(e){e.hasOwnProperty("person")&&c(),e.hasOwnProperty("department")&&r(),e.hasOwnProperty("tag")&&l()}(i)}]),e.service("TagsService",[function(){var e={isSingle:!1,_tags:[],checks:[]};return e.init=function(s){for(var t in s)e[t]=s[t]},e.hasMore=function(s){return e._tags.length<s},e.clickTag=function(s){var t=e._tags[s];if(t.selected=!t.selected,t.selected)e.isSingle&&(e.checks.forEach(function(e){e.selected=!1}),e.checks.length=0),e.checks.push(t);else for(var a in e.checks)if(t.id==e.checks[a].id){e.checks.splice(a,1);break}},e}]),e.factory("AdvancedChooser",["$q","$modal",function(e,s){return{choose:function(t,a,n){var i=e.defer(),c=s.open({templateUrl:"templates/choose-advanced.html",size:a||"lg",resolve:{selected:function(){return t},params:function(){return n||{}}},controller:["$scope","$modalInstance","selected","params",function(e,s,t,a){e.selectedList=t,e.params=a,e.doOk=function(e){s.close(e)},e.doCancel=function(e){s.dismiss(e||"cancel")}}]});return c.opened.then(function(){}),c.result.then(function(e){i.resolve(e)},function(e){i.reject(e)}),{result:i.promise}}}}])}(angular.module("ng.poler.plugins.pc"));